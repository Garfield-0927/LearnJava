# Chapter 30 多线程

### 30.1 线程的概念

#### 30.1.1 程序、进程和线程

- 程序：一个静态的对象，内含指令和数据的文件，存储在磁盘或其他存储设备中
- 进程：一个动态的对象，是程序的一个执行过程，存在于系统内存中。一个进程对应于一个程序
- 线程：运行于某个进程中，用于完成某个具体任务的顺序控制流程，**程序中完成一个任务的有始有终的执行流，都有一个执行的起点，经过一系列指令后到达终点。**

![image-20210519173606301](assets\image-20210519173606301.png)

​		不同进程的内存空间是隔离的，因此进程1中的变量i与进程2中的变量i属于不同的内存空间。进程切换和进程间通信开销大。进程间交换数据只能通过：共享内存、管道、消息队列、Socket通信等机制

​		一个进程里的线程切换开销小的多，因为它们位于同一内存空间里。线程1、2线程位于同一内存空间使得线程之间数据交换非常容易。变量i可以被线程1、2访问（但要考虑同步）。因此线程又叫轻量级进程

​		**当一个进程被创建，自动地创建了一个主线程。因此，一个进程至少有一个主线程。**



#### 30.1.2 线程作用

- 一个进程的多个子线程可以**并发运行**。
- 多线程可以使程序 反应更快、交互性更强、执行效率更高。
- 应用：Server端程序，GUI程序
  - Server端的程序，都是需要启动多个线程来处理大量来自客户端的请求
  - GUI程序：GUI线程：处理UI消息循环，如鼠标消息、键盘消息；Worker线程：后台的数据处理工作，比如打印文件，大数据量的运算



### 30.2 Runnable接口和Thread线程类

#### 30.2.1 通过实现Runnable几口创建线程

具体步骤：

1. 实现Runnable接口，实现唯一的接口方法run
2. 创建实现Runnable接口的类的具体对象
3. 利用Thread类的构造函数创建线程对象
4. 通过线程对象的start方法启动线程

代码举例：

```java
public class RunnableDemo implements Runnable{
    public RunnableDemo(){
        // constructor function
    }
    
    @Override
    public void run() {
        // do something
    }

    public static void main(String[] args) {
        // 创建一个实现了Runnable接口的实例
        Runnable task = new RunnableDemo();
        // 创建一个线程，注意new Thread()中的参数必须是实现了Runnable接口的实例
        Thread thread1 = new Thread(task);
        // 启动线程，会执行task的run方法
        thread1.start();
    }
}
```

**注意：任何线程只能启动依次，多次调用产生`IllegalThreadStateException`异常**



#### 30.2.2 通过继承Thread类创建线程

具体步骤：

1. 定义Thread类的扩展类，在扩展类中重写run方法
2. 通过扩展类创建线程对象
3. 通过线程对象的start方法启动线程

代码举例：

```java
public class ThreadDemo {
    public static void main(String[] args) {
        Thread thread1 = new PrintCharDemo2('a');
        Thread thread2 = new PrintCharDemo2('b');
        thread1.start();
        thread2.start();
    }

}

// 扩展类继承了Thread类
class PrintCharDemo2 extends Thread{
    private char printedChar;
    public PrintCharDemo2(char a){
        this.printedChar = a;
    }

    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println(this.printedChar);
        }
    }
}
```





### 30.3 线程池

### 30.4 线程同步

### 30.5 信号量

### 30.6 同步合集